<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ä»£è¿”ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ with ä»²é–“ç™»éŒ²</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background-color: #f9f9f9;
    }
    h1, h2 {
      color: #333;
    }
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid #aaa;
      padding: 10px;
      text-align: center;
      vertical-align: top;
    }
    input[type="text"], select {
      width: 90%;
      margin-bottom: 5px;
    }
    .list-item {
      background: #e0f7fa;
      margin: 5px 0;
      padding: 10px;
    }
  </style>
</head>
<body>

  <h1>ğŸ“ ä»£è¿”ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼‹ä»²é–“ç®¡ç†</h1>

  <!-- ä»²é–“ã®ç™»éŒ² -->
  <h2>ğŸ‘¥ ä»£è¿”ä»²é–“ã‚’ç™»éŒ²</h2>
  <input type="text" id="friendName" placeholder="åå‰ã‚’å…¥åŠ›">
  <button onclick="addFriend()">ç™»éŒ²</button>
  <ul id="friendList"></ul>

  <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
  <h2>ğŸ—“ï¸ æˆæ¥­ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h2>
  <table id="calendar">
    <thead>
      <tr>
        <th></th>
        <th>æœˆ</th><th>ç«</th><th>æ°´</th><th>æœ¨</th><th>é‡‘</th>
      </tr>
    </thead>
    <tbody>
      <script>
        for (let i = 1; i <= 5; i++) {
          document.write('<tr>');
          document.write(`<th>${i}é™</th>`);
          for (let j = 0; j < 5; j++) {
            const cellId = `cell-${i}-${j}`;
            document.write(`
              <td id="${cellId}">
                <input type="text" placeholder="æˆæ¥­å" onchange="saveClass(${i}, ${j}, this.value)">
                <br/>
                <select id="friend-${i}-${j}">
                  <option value="">--ä»£è¿”ã™ã‚‹äºº--</option>
                </select>
                <button onclick="requestä»£è¿”(${i}, ${j})">ä»£è¿”ç™»éŒ²</button>
              </td>
            `);
          }
          document.write('</tr>');
        }
      </script>
    </tbody>
  </table>

  <!-- ä»£è¿”ãƒªã‚¹ãƒˆ -->
  <h2>ğŸ“ ä»£è¿”ã‚·ãƒ•ãƒˆ</h2>
  <ul id="shiftList"></ul>

  <script>
    // èµ·å‹•æ™‚ã«å…¨ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ
    window.onload = function() {
      // æˆæ¥­ãƒ‡ãƒ¼ã‚¿
      const classData = JSON.parse(localStorage.getItem("calendarData") || "{}");
      for (const key in classData) {
        const cell = document.getElementById(key);
        if (cell) {
          cell.querySelector("input").value = classData[key];
        }
      }

      // ä»²é–“ãƒªã‚¹ãƒˆ
      const friends = JSON.parse(localStorage.getItem("friendList") || "[]");
      friends.forEach(name => addFriendOption(name));
      updateFriendListDisplay(friends);

      // ä»£è¿”ã‚·ãƒ•ãƒˆ
      const daibenList = JSON.parse(localStorage.getItem("daibenList") || "[]");
      daibenList.forEach(text => addListItem(text));
    };

    // æˆæ¥­ã‚’ä¿å­˜
    function saveClass(period, day, value) {
      const key = `cell-${period}-${day}`;
      const current = JSON.parse(localStorage.getItem("calendarData") || "{}");
      current[key] = value;
      localStorage.setItem("calendarData", JSON.stringify(current));
    }

    // ä»£è¿”ä»²é–“è¿½åŠ 
    function addFriend() {
      const name = document.getElementById("friendName").value.trim();
      if (!name) return;
      let friends = JSON.parse(localStorage.getItem("friendList") || "[]");
      if (friends.includes(name)) return;
      friends.push(name);
      localStorage.setItem("friendList", JSON.stringify(friends));
      addFriendOption(name);
      updateFriendListDisplay(friends);
      document.getElementById("friendName").value = "";
    }

    function addFriendOption(name) {
      for (let i = 1; i <= 5; i++) {
        for (let j = 0; j < 5; j++) {
          const select = document.getElementById(`friend-${i}-${j}`);
          const option = document.createElement("option");
          option.value = name;
          option.text = name;
          select.appendChild(option);
        }
      }
    }

    function updateFriendListDisplay(friends) {
  const ul = document.getElementById("friendList");
  ul.innerHTML = "";
  friends.forEach(name => {
    const li = document.createElement("li");

    const span = document.createElement("span");
    span.textContent = name;

    const btn = document.createElement("button");
    btn.textContent = "å‰Šé™¤";
    btn.style.marginLeft = "10px";
    btn.onclick = () => {
      deleteFriend(name);
    };

    li.appendChild(span);
    li.appendChild(btn);
    ul.appendChild(li);
  });
}


    // ä»£è¿”ç™»éŒ²
    function requestä»£è¿”(period, day) {
      const cell = document.getElementById(`cell-${period}-${day}`);
      const subject = cell.querySelector("input").value.trim();
      const select = document.getElementById(`friend-${period}-${day}`);
      const friend = select.value;

      if (!subject || !friend) {
        alert("æˆæ¥­åã¨ä»£è¿”è€…ã‚’é¸ã‚“ã§ãã ã•ã„ï¼");
        return;
      }

      const days = ["æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘"];
      const message = `${days[day]}æ›œ ${period}é™ã€${subject}ã€ã‚’ ${friend} ãŒä»£è¿”äºˆå®š`;
      addListItem(message);

      const list = JSON.parse(localStorage.getItem("daibenList") || "[]");
      list.push(message);
      localStorage.setItem("daibenList", JSON.stringify(list));
    }

    function addListItem(text) {
      const li = document.createElement("li");
      li.className = "list-item";
      li.innerText = text;
      document.getElementById("shiftList").appendChild(li);
    }
  </script>

</body>
</html>
